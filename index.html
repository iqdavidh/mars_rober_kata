<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mars Rover Game - davidh</title>

</head>
<body>

<h3>Usar las flecha del teclado para mover el rover</h3>
<p>@iqdavidh</p>


<canvas id="myCanvas" width="420" height="420" style="border:2px solid #d3d3d3; margin-left: 50px">

    Your browser does not support the HTML5 canvas tag.
</canvas>


<script>
    "use strict";
    var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");


    function Punto(x, y) {
        this.x = x;
        this.y = y;
    }

    let Land = {

            getXMapaMitad: function () {
                //es 1/2 del width del canvas 800/2
                return 200;
            },
            getYMapaMitad: function () {
                //es 1/2 del heigth del canvas 600/2
                return 200;
            },
            validarX: function (x) {
                return x >= (-this.getXMapaMitad()) && x <= this.getXMapaMitad();
            },
            validarY: function (y) {
                return y >= (-this.getYMapaMitad()) && y <= this.getYMapaMitad();
            },
            renderBot: function (xCart, yCart, dir, color) {

                //console.log('render ' + xCart + ',' + yCart);
                ctx.fillStyle = color;
                ctx.strokeStyle = color;

                let xMapaMitad = this.getXMapaMitad();
                let yMapaMitad = this.getYMapaMitad();
                let alfa = 10; /* la mitad del cuadrado que rodea al item*/

                let x = xMapaMitad + xCart;
                let y = yMapaMitad - yCart;

                let p1 = new Punto(x, y);
                let p2 = new Punto(x, y);
                let p3 = new Punto(x, y);


                if (dir === 'N') {
                    p1 = new Punto(x, y + 2 * alfa);
                    p2 = new Punto(x + alfa, y);
                    p3 = new Punto(x + (2 * alfa), y + (2 * alfa));

                } else if (dir === 'S') {

                    p2 = new Punto(x + (2 * alfa), y);
                    p3 = new Punto(x + alfa, y + 2 * alfa);

                } else if (dir === 'E') {

                    p2 = new Punto(x + 2 * alfa, y + alfa);
                    p3 = new Punto(x, y + 2 * alfa);

                } else {
                    p1 = new Punto(x + 2 * alfa, y);
                    p2 = new Punto(x + 2 * alfa, y + 2 * alfa);
                    p3 = new Punto(x, y + alfa);
                }

                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.lineTo(p3.x, p3.y);
                ctx.closePath();

                ctx.fill();
            },
            deleteBot: function (xCart, yCart) {
                //console.log('borrar ' + xCart + ',' + yCart);


                let xMapaMitad = this.getXMapaMitad();
                let yMapaMitad = this.getYMapaMitad();
                let alfa = 10; /* la mitad del cuadrado que rodea al item*/

                let x = xMapaMitad + xCart;
                let y = yMapaMitad - yCart;

                //console.log('borrar ' + x + ',' + y);
                ctx.clearRect(x, y, alfa * 2, alfa * 2);


            }, renderMovimiento: function (xold, yold, xnew, ynew, dir, color) {

                let self = this;

                self.deleteBot(xold, yold);
                self.renderBot(xnew, ynew, dir, color);
                /*
                let fn = function () {

                };

                setTimeout(fn, 100)
                */


            },
            rover: null,

            addRover: function (r) {
                this.rover = r;
                this.renderBot(r.posicion.x * 10 * 2, r.posicion.y * 10 * 2, r.direccion, this.rover.colorStyle)

            }


        }
    ;

</script>

<script src="javascripts/app.js?v=1"></script>


<script>


    rover.isVerbose = false;
    rover.randomPosicion();
    rover.setRandomColor();


    c.style.borderColor = rover.colorStyle;

    Land.addRover(rover);

    document.addEventListener('keydown', (event) => {
        const keyName = event.key;

        if (keyName === 'Control') {
            // do not alert when only Control key is pressed.
            return;
        }

        let movimiento = '';

        if (keyName === 'ArrowUp') {
            movimiento = 'forward';
        } else if (keyName === 'ArrowDown') {
            movimiento = 'backward';
        } else if (keyName === 'ArrowRight') {
            movimiento = 'turnRight';
        } else if (keyName === 'ArrowLeft') {
            movimiento = 'turnLeft';
        } else {
            return;

        }


        let r = this.rover;

        let xOld = r.posicion.x * 2 * 10;
        let yOld = r.posicion.y * 2 * 10;

        r.mover(movimiento);

        let xNew = r.posicion.x * 2 * 10;
        let yNew = r.posicion.y * 2 * 10;

        //console.log("mov " + xOld + ',' + yOld + ' to ' + xNew + ',' + yNew);

        Land.renderMovimiento(xOld, yOld, xNew, yNew, r.direccion, r.colorStyle);

    }, false);

</script>

</body>
</html>
